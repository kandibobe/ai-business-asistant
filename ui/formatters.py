"""
–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫—Ä–∞—Å–∏–≤—ã–º –≤—ã–≤–æ–¥–æ–º.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è AI –æ—Ç–≤–µ—Ç–æ–≤, –Ω–∞—Å—Ç—Ä–æ–µ–∫, –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ —Ç.–¥.
"""
from typing import Dict, Any, List
from datetime import datetime


def format_ai_answer(
    answer: str,
    role: str = 'assistant',
    style: str = 'standard',
    processing_time: float = 0,
    source_doc: str = None
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç AI –æ—Ç–≤–µ—Ç —Å –∫—Ä–∞—Å–∏–≤—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º.

    Args:
        answer: –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI
        role: –†–æ–ª—å AI (–¥–ª—è –∏–∫–æ–Ω–∫–∏)
        style: –°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞ (–¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
        processing_time: –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        source_doc: –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    from config.ai_personas import get_role_display_name, get_style_display_name

    role_display = get_role_display_name(role)
    style_display = get_style_display_name(style)

    # –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—É—é –ª–∏–Ω–∏—é –≤–≤–µ—Ä—Ö—É
    header = f"‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ\n"
    header += f"‚îÇ  {role_display}  ‚îÇ\n"
    header += f"‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ\n\n"

    # –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç–≤–µ—Ç
    formatted_answer = header + answer

    # –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É—Ç–µ—Ä —Å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    footer = "\n\n"
    footer += "‚îÄ" * 30 + "\n"

    if source_doc:
        footer += f"üìé <i>–ò—Å—Ç–æ—á–Ω–∏–∫: {source_doc[:40]}{'...' if len(source_doc) > 40 else ''}</i>\n"

    footer += f"‚öôÔ∏è <i>–°—Ç–∏–ª—å: {style_display}</i>\n"

    if processing_time > 0:
        footer += f"‚è±Ô∏è <i>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ {processing_time:.1f} —Å–µ–∫</i>\n"

    footer += "\nüí° <i>–ó–∞–¥–∞–π—Ç–µ —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ</i>"

    return formatted_answer + footer


def format_settings_overview(user_settings: Dict[str, Any]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ–±–∑–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        user_settings: –°–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        –ö—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±–∑–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
    """
    from config.ai_personas import (
        get_role_display_name,
        get_style_display_name,
        get_mode_display_name,
        LANGUAGES
    )

    role = user_settings.get('ai_role', 'assistant')
    style = user_settings.get('response_style', 'standard')
    mode = user_settings.get('ai_mode', 'standard')
    lang = user_settings.get('language', 'ru')

    lang_info = LANGUAGES.get(lang, LANGUAGES['ru'])

    return f"""
‚öôÔ∏è <b>–í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</b>

<b>AI –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</b>
üé≠ –†–æ–ª—å: {get_role_display_name(role)}
üìù –°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤: {get_style_display_name(style)}
‚ö° –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: {get_mode_display_name(mode)}

<b>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:</b>
üåê –Ø–∑—ã–∫: {lang_info['flag']} {lang_info['name']}
üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {'‚úÖ –í–∫–ª' if user_settings.get('notifications', True) else '‚ùå –í—ã–∫–ª'}

<b>Premium:</b>
{'üíé –ê–∫—Ç–∏–≤–Ω–∞ Premium –ø–æ–¥–ø–∏—Å–∫–∞' if user_settings.get('is_premium') else '‚ú® Premium –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω'}

üìå <i>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫</i>
"""


def format_role_selection() -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ AI"""
    return """
üé≠ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å AI –ø–æ–º–æ—â–Ω–∏–∫–∞</b>

–†–æ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∏–ª—å –∏ –ø–æ–¥—Ö–æ–¥ –∫ –æ—Ç–≤–µ—Ç–∞–º:

üìä <b>–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫</b> - —Ñ–æ–∫—É—Å –Ω–∞ —Ü–∏—Ñ—Ä–∞—Ö –∏ –º–µ—Ç—Ä–∏–∫–∞—Ö
üíº <b>–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</b> - —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
üë®‚Äçüè´ <b>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</b> - –ø—Ä–æ—Å—Ç—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
üî¨ <b>–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å</b> - –≥–ª—É–±–æ–∫–∏–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
üé® <b>–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π</b> - –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥
ü§ñ <b>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π</b> - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
‚öñÔ∏è <b>–Æ—Ä–∏—Å—Ç</b> - —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã

üí° <i>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏</i>
"""


def format_style_selection() -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è –æ—Ç–≤–µ—Ç–æ–≤"""
    return """
üìù <b>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤</b>

–°—Ç–∏–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∏ –æ–±—ä–µ–º –æ—Ç–≤–µ—Ç–æ–≤:

‚ö° <b>–ö—Ä–∞—Ç–∫–æ</b> - —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
üìù <b>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ</b> - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
üìö <b>–ü–æ–¥—Ä–æ–±–Ω–æ</b> - –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ –≤—Å–µ–º–∏ –Ω—é–∞–Ω—Å–∞–º–∏
üìã <b>–°–ø–∏—Å–∫–æ–º</b> - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ bullet points
‚öñÔ∏è <b>–ü–ª—é—Å—ã/–ú–∏–Ω—É—Å—ã</b> - –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤
üë∂ <b>–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏</b> - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∫ –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞
üíé <b>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ</b> - –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤

üí° <i>–í—ã –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å —Å—Ç–∏–ª—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç</i>
"""


def format_processing_status(
    status: str,
    progress: int = 0,
    doc_name: str = None,
    step: str = None
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º.

    Args:
        status: –°—Ç–∞—Ç—É—Å ('processing', 'analyzing', 'done', 'error')
        progress: –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç 0 –¥–æ 100
        doc_name: –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        step: –¢–µ–∫—É—â–∏–π —à–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º
    """
    status_icons = {
        'uploading': 'üì§',
        'processing': '‚öôÔ∏è',
        'analyzing': 'ü§ñ',
        'done': '‚úÖ',
        'error': '‚ùå'
    }

    status_texts = {
        'uploading': '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...',
        'processing': '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...',
        'analyzing': 'AI –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ...',
        'done': '–ì–æ—Ç–æ–≤–æ!',
        'error': '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏'
    }

    icon = status_icons.get(status, '‚è≥')
    text = status_texts.get(status, '–û–±—Ä–∞–±–æ—Ç–∫–∞...')

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    bar_length = 20
    filled = int((progress / 100) * bar_length)
    bar = '‚ñà' * filled + '‚ñë' * (bar_length - filled)

    message = f"{icon} <b>{text}</b>\n\n"

    if doc_name:
        message += f"üìÑ {doc_name}\n\n"

    if progress > 0 and progress < 100:
        message += f"[{bar}] {progress}%\n\n"

    if step:
        message += f"<i>{step}</i>\n"

    if status == 'done':
        message += "\n‚ú® <i>–î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!</i>"
    elif status == 'error':
        message += "\n‚ö†Ô∏è <i>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –µ—â–µ —Ä–∞–∑</i>"

    return message


def format_quick_help(context: str = 'general') -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É.

    Args:
        context: –ö–æ–Ω—Ç–µ–∫—Å—Ç ('general', 'document', 'question', 'settings')

    Returns:
        –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    helps = {
        'general': """
üí° <b>–ü–æ–¥—Å–∫–∞–∑–∫–∞</b>

<b>–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/stats - –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/mydocs - –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
/help - –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞

<b>–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ:</b>
üì§ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
üí¨ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ –∞–∫—Ç–∏–≤–Ω–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—É
üîó –û—Ç–ø—Ä–∞–≤—å—Ç–µ URL –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
""",

        'document': """
üí° <b>–†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º</b>

<b>–í—ã –º–æ–∂–µ—Ç–µ:</b>
üí¨ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å - –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç
üìä –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å - —Å–æ–∑–¥–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ (–¥–ª—è Excel)
üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å - –ø–æ–ª—É—á–∏—Ç—å PDF –æ—Ç—á–µ—Ç
üìã –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
üîç –ò–∑–≤–ª–µ—á—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞

<b>–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:</b>
"–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã?"
"–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ?"
"–ü–µ—Ä–µ—á–∏—Å–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Ä–∏—Å–∫–∏"
""",

        'question': """
üí° <b>–ö–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã</b>

<b>–°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</b>
‚úÖ –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö
‚úÖ –ú–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–∏—Ç—å –ø–æ—è—Å–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç
‚úÖ –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö
‚úÖ –ü—Ä–æ—Å–∏—Ç–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã

<b>–ü–ª–æ—Ö–æ:</b> "–ß—Ç–æ —Ç—É—Ç?"
<b>–•–æ—Ä–æ—à–æ:</b> "–ö–∞–∫–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ Q3?"
""",

        'settings': """
üí° <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI</b>

<b>–†–æ–ª—å</b> - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–¥—Ö–æ–¥ –∫ –æ—Ç–≤–µ—Ç–∞–º
(–∞–Ω–∞–ª–∏—Ç–∏–∫, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å)

<b>–°—Ç–∏–ª—å</b> - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
(–∫—Ä–∞—Ç–∫–æ, –ø–æ–¥—Ä–æ–±–Ω–æ, —Å–ø–∏—Å–∫–æ–º)

<b>–†–µ–∂–∏–º</b> - –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ
(–±—ã—Å—Ç—Ä—ã–π, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

üí° –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!
"""
    }

    return helps.get(context, helps['general'])


def format_document_card(doc: Dict[str, Any], is_active: bool = False) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞.

    Args:
        doc: –î–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        is_active: –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω—ã–º

    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
    """
    type_icons = {
        'pdf': 'üìÑ',
        'excel': 'üìä',
        'word': 'üìù',
        'url': 'üåê',
        'audio': 'üé§'
    }

    icon = type_icons.get(doc.get('type_raw', ''), 'üìé')
    active_mark = " ‚úÖ <b>–ê–ö–¢–ò–í–ù–´–ô</b>" if is_active else ""

    name = doc.get('name', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')
    if len(name) > 35:
        name = name[:32] + "..."

    size = doc.get('size', 'N/A')
    date = doc.get('created_at', 'N/A')
    words = doc.get('word_count', 0)

    card = f"{icon} <code>{name}</code>{active_mark}\n"
    card += f"    üìè {size} ¬∑ üìù {words:,} —Å–ª–æ–≤ ¬∑ üìÖ {date}\n"

    return card


def format_error_message(error_type: str, details: str = None) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –ø–æ–ª–µ–∑–Ω—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏.

    Args:
        error_type: –¢–∏–ø –æ—à–∏–±–∫–∏
        details: –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏

    Returns:
        –ö—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    """
    error_messages = {
        'file_too_large': {
            'icon': 'üì¶',
            'title': '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π',
            'message': 'Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –¥–æ 20 MB.',
            'solution': 'üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∂–∞—Ç—å —Ñ–∞–π–ª –∏–ª–∏ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏'
        },
        'unsupported_format': {
            'icon': 'üìé',
            'title': '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç',
            'message': '–≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.',
            'solution': 'üí° –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: PDF, Excel, Word, –ê—É–¥–∏–æ'
        },
        'processing_failed': {
            'icon': '‚ö†Ô∏è',
            'title': '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏',
            'message': '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç.',
            'solution': 'üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –µ—â–µ —Ä–∞–∑'
        },
        'no_active_document': {
            'icon': 'üìÑ',
            'title': '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞',
            'message': '–ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç.',
            'solution': 'üí° –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞'
        },
        'api_error': {
            'icon': 'üîå',
            'title': '–û—à–∏–±–∫–∞ API',
            'message': '–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ AI —Å–µ—Ä–≤–∏—Å—É.',
            'solution': 'üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥'
        },
    }

    error_info = error_messages.get(error_type, {
        'icon': '‚ùå',
        'title': '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',
        'message': details or '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',
        'solution': 'üí° –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è'
    })

    message = f"{error_info['icon']} <b>{error_info['title']}</b>\n\n"
    message += f"{error_info['message']}\n\n"
    message += f"{error_info['solution']}"

    if details:
        message += f"\n\n<i>–î–µ—Ç–∞–ª–∏: {details[:100]}</i>"

    return message


def format_success_message(action: str, details: str = None) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ.

    Args:
        action: –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è
        details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

    Returns:
        –ö—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    success_messages = {
        'document_uploaded': {
            'icon': '‚úÖ',
            'title': '–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!',
            'next': '–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–æ–∫—É–º–µ–Ω—Ç–∞'
        },
        'settings_saved': {
            'icon': 'üíæ',
            'title': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!',
            'next': '–ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ —Å–ª–µ–¥—É—é—â–∏–º –æ—Ç–≤–µ—Ç–∞–º'
        },
        'export_ready': {
            'icon': 'üì•',
            'title': '–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤!',
            'next': '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –≤—ã—à–µ –≤ —á–∞—Ç–µ'
        },
        'document_deleted': {
            'icon': 'üóëÔ∏è',
            'title': '–î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω',
            'next': '–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç'
        },
    }

    success_info = success_messages.get(action, {
        'icon': '‚úÖ',
        'title': '–ì–æ—Ç–æ–≤–æ!',
        'next': details or ''
    })

    message = f"{success_info['icon']} <b>{success_info['title']}</b>\n\n"

    if success_info['next']:
        message += f"‚û°Ô∏è {success_info['next']}"

    if details and action not in success_messages:
        message += f"\n\n{details}"

    return message
