# ==============================================================================
# TESTING ENVIRONMENT CONFIGURATION
# ==============================================================================
#
# This file contains test-specific settings.
# Used for automated testing (unit, integration, e2e).
#
# To use: export ENVIRONMENT=testing
# ==============================================================================

# --- Environment ---
ENVIRONMENT=testing
TESTING=true

# --- Telegram Bot Configuration ---
# Mock/test bot token
TELEGRAM_BOT_TOKEN=test_bot_token_1234567890_mock_for_testing_only

# --- AI Configuration ---
# Mock API keys for testing (won't make real API calls)
GEMINI_API_KEY=test_gemini_api_key_mock_for_testing
OPENAI_API_KEY=test_openai_api_key_mock_for_testing

# Use flash model for faster tests
GEMINI_MODEL_NAME=gemini-1.5-flash-002
GEMINI_FLASH_MODEL=gemini-1.5-flash-002

# --- Database Configuration ---
# In-memory SQLite for fast tests
DB_HOST=localhost
DB_PORT=5432
DB_USER=test_user
DB_PASS=test_password
DB_NAME=ai_bot_test

# Alternative: Use PostgreSQL test container
# DB_HOST=localhost
# DB_PORT=5433  # Different port to avoid conflicts

# --- Redis Configuration ---
# Mock Redis for testing (or use separate test instance)
REDIS_URL=redis://localhost:6379/15

# Very short cache TTL for tests
AI_CACHE_TTL=10

# --- Logging Configuration ---
LOG_LEVEL=DEBUG
LOG_FILE=logs/testing.log
JSON_LOGS=false

# --- API Configuration ---
API_PORT=8001

# Test JWT secret
JWT_SECRET_KEY=test-jwt-secret-key-for-testing-only-min-32-characters-long

# --- CORS ---
ALLOWED_ORIGINS=http://localhost:8001,http://testserver

# --- Security Configuration ---
# Relaxed limits for testing
MAX_FILE_SIZE_MB=10
RATE_LIMIT_PER_MINUTE=1000
RATE_LIMIT_PER_MINUTE_PREMIUM=2000

# --- Feature Flags ---
# Enable all features for comprehensive testing
ENABLE_AUDIO_TRANSCRIPTION=true
ENABLE_WEB_SCRAPING=true
ENABLE_AI_CACHING=true
ENABLE_METRICS=true

# --- Monitoring ---
# Disable Sentry in tests
# SENTRY_DSN=

# --- Performance Tuning ---
# Minimal workers for tests
CELERY_WORKER_CONCURRENCY=1
CELERY_TASK_TIME_LIMIT=60
MAX_CONTEXT_LENGTH=10000

# --- Testing Specific ---
# Enable all debug features for tests
DEBUG_SQL_QUERIES=false
DEBUG_LOG_REQUESTS=false
DEBUG_SLOW_QUERY_THRESHOLD=0.1

# No reload during tests
RELOAD=false

# Mock external services
MOCK_AI_SERVICES=true
MOCK_TELEGRAM_API=true
MOCK_FILE_STORAGE=true

# --- Test Database ---
# Use in-memory database for speed
USE_IN_MEMORY_DB=true

# Clean database after each test
AUTO_CLEANUP=true

# --- Test Coverage ---
# Minimum code coverage threshold
MIN_COVERAGE_PERCENT=70

# --- Test Fixtures ---
# Path to test fixtures
TEST_FIXTURES_PATH=tests/fixtures

# --- Async Testing ---
# Pytest asyncio mode
ASYNCIO_MODE=auto

# ==============================================================================
# TESTING BEST PRACTICES
# ==============================================================================
#
# When running tests:
#
# ✅ Use separate test database (never use production!)
# ✅ Mock external API calls (Gemini, OpenAI, Telegram)
# ✅ Use fixtures for test data
# ✅ Clean up after tests (delete test files, reset DB)
# ✅ Run tests in isolation (no shared state)
# ✅ Use test containers for integration tests
# ✅ Measure and maintain > 70% code coverage
# ✅ Run tests in CI/CD pipeline
#
# Test Commands:
# - Unit tests: pytest tests/unit/
# - Integration tests: pytest tests/integration/
# - E2E tests: pytest tests/e2e/
# - All tests: pytest
# - With coverage: pytest --cov=. --cov-report=html
#
# ==============================================================================
