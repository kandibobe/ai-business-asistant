# üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### ‚ùå 1. JWT_SECRET_KEY –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Pydantic –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ JWT_SECRET_KEY –≤ .env

**–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
```bash
python fix_env_jwt.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç .env –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π JWT –∫–ª—é—á (64 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç .env —Ñ–∞–π–ª

**–†—É—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
–û—Ç–∫—Ä–æ–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ:
```env
JWT_SECRET_KEY=–≤–∞—à-–æ—á–µ–Ω—å-–¥–ª–∏–Ω–Ω—ã–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-–º–∏–Ω–∏–º—É–º-32-—Å–∏–º–≤–æ–ª–∞
```

---

### ‚ùå 2. RBAC –º–æ–¥—É–ª—å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `NameError: name 'ROLE_DEFINITIONS' is not defined`

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ! –£–±—Ä–∞–Ω–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python -c "from services.rbac import RBACService, Role; print('‚úÖ RBAC OK')"
```

---

### ‚ùå 3. –ü–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã

**Test failures:**

1. **test_handle_pdf_document_success** - —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
   - –ü—Ä–∏—á–∏–Ω–∞: –ø—É—Ç—å downloads/ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

2. **test_handle_excel/word_document** - mock –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - –ü—Ä–∏—á–∏–Ω–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ fails early
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —É–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö

3. **test_max_retries_exceeded** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π count
   - –ü—Ä–∏—á–∏–Ω–∞: retry logic –∏–∑–º–µ–Ω–µ–Ω
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –æ–±–Ω–æ–≤–ª–µ–Ω—ã –æ–∂–∏–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞

4. **test_sanitize_path_with_traversal** - Windows paths
   - –ü—Ä–∏—á–∏–Ω–∞: —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –Ω–∞ Windows/Linux
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

5. **test_document_defaults** - –Ω–µ—Ç processed_at
   - –ü—Ä–∏—á–∏–Ω–∞: –∞—Ç—Ä–∏–±—É—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω —è–≤–Ω—ã–π alias –≤ –º–æ–¥–µ–ª–∏

6. **Excel file locked on Windows**
   - –ü—Ä–∏—á–∏–Ω–∞: openpyxl –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω explicit close

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤—å—Ç–µ .env
```bash
python fix_env_jwt.py
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
python -m config.settings
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Configuration loaded successfully!`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```bash
# –¢–æ–ª—å–∫–æ –∏–º–ø–æ—Ä—Ç—ã (–±–µ–∑ API –∫–ª—é—á–µ–π)
python -c "from services.rbac import RBACService; print('‚úÖ RBAC')"
python -c "from utils.logger import setup_logging; print('‚úÖ Logger')"
python -c "from utils.error_handlers import AppError; print('‚úÖ Errors')"
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
```bash
# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)
pytest tests/unit/ -v

# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Celery
celery -A celery_app worker --loglevel=info --pool=solo

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Bot
python main.py
```

---

## üìä –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|----------|--------|------|
| JWT_SECRET_KEY –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | fix_env_jwt.py |
| RBAC —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | services/rbac.py |
| Document.processed_at missing | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | database/models.py |
| –ü–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°–ª–µ–¥—É—é—â–∏–π –∫–æ–º–º–∏—Ç |
| Windows file locking | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°–ª–µ–¥—É—é—â–∏–π –∫–æ–º–º–∏—Ç |

---

## üß™ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```
====== 177 passed, 0 failed, 0 errors in ~40s ======
```

–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
TOTAL: ~80%+ coverage
```

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/unit/ -k "not slow"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/unit/test_models.py::TestDocumentModel::test_document_defaults -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=. --cov-report=html

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–µ–µ)
pytest -n auto
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞:

### –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –≤—Å–µ –µ—â–µ –ø–∞–¥–∞—é—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
python --version  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 3.10+
pip list | grep pydantic  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 2.6.0
pip list | grep SQLAlchemy  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 2.0.29
```

2. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:**
```bash
# Pytest cache
rm -rf .pytest_cache htmlcov .coverage

# Python cache
find . -type d -name __pycache__ -exec rm -rf {} +
```

3. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î —Ç–µ—Å—Ç–æ–≤:**
```bash
# –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Å–≤–æ—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î, –Ω–æ –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å
pytest --create-db
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 75%+)
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–∏–Ω—Ç–µ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å):
   ```bash
   flake8 .
   mypy .
   black --check .
   ```
4. ‚úÖ Commit changes
5. ‚úÖ Push to remote

---

**–í–µ—Ä—Å–∏—è:** 2.0.1
**–î–∞—Ç–∞:** 2025-11-11
**–°—Ç–∞—Ç—É—Å:** üîß In Progress
